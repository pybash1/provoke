<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provoke Data Labeler</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#0a0a0c',
                        surface: '#121217',
                        primary: '#6366f1',
                        secondary: '#ec4899',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        'text-dim': '#94a3b8',
                        border: 'rgba(255, 255, 255, 0.08)',
                        glass: 'rgba(255, 255, 255, 0.03)',
                    },
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        @layer base {
            body {
                @apply bg-bg text-[#e2e8f0] font-mono leading-relaxed min-h-screen p-8;
            }
            * {
                @apply rounded-none;
            }
        }
        @layer components {
            .card {
                @apply bg-surface border border-border p-10 shadow-2xl;
            }
            .snippet-box {
                @apply text-[1.1rem] text-text-dim bg-white/[0.02] p-6 border-l-4 border-primary mb-8;
            }
            .btn-action {
                @apply p-4 font-bold text-base cursor-pointer transition-all duration-200 flex flex-col items-center gap-2 bg-white/[0.03] border border-border text-white hover:border-primary hover:bg-white/[0.05] active:scale-95;
            }
            .btn-action kbd {
                @apply bg-white/10 px-2 py-0.5 text-[0.75rem] border-b-2 border-black/30;
            }
        }
    </style>
</head>

<body>
    <div class="max-w-[800px] mx-auto">
        <header class="flex justify-between items-center mb-12">
            <h1 class="text-4xl font-bold tracking-tight text-white">Data Labeler</h1>
            <a href="/admin" class="text-text-dim hover:text-white font-semibold transition-colors text-sm">Dashboard
                â†’</a>
        </header>

        <div id="label-container">
            {% if item %}
            <div class="card" id="item-card">
                <div class="mb-4">
                    <h2 class="text-2xl font-bold text-white mb-2" id="item-title">{{ item.title or 'Untitled' }}</h2>
                    <a href="{{ item.url }}" target="_blank"
                        class="text-primary text-sm hover:underline font-mono truncate block" id="item-url">{{ item.url
                        }}</a>
                </div>

                <div class="snippet-box" id="item-snippet">
                    {{ item.snippet }}
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <button onclick="submitLabel('good')" class="btn-action hover:!border-success group">
                        <span class="group-hover:text-success transition-colors uppercase">PROVOKE (GOOD)</span>
                        <kbd>G</kbd>
                    </button>
                    <button onclick="submitLabel('bad')" class="btn-action hover:!border-danger group">
                        <span class="group-hover:text-danger transition-colors uppercase">REJECT (BAD)</span>
                        <kbd>B</kbd>
                    </button>
                    <button onclick="submitLabel('unsure')" class="btn-action hover:!border-warning group">
                        <span class="group-hover:text-warning transition-colors uppercase">UNSURE (?)</span>
                        <kbd>U</kbd>
                    </button>
                </div>

                <div class="mt-8 text-center text-text-dim text-xs">
                    Use keys <span class="text-primary font-bold">G</span>, <span
                        class="text-danger font-bold">B</span>, or <span class="text-warning font-bold">U</span> for
                    quick labeling.
                </div>
            </div>
            {% else %}
            <div class="text-center py-20 bg-surface border border-border">
                <h2 class="text-3xl font-bold text-white mb-4">All caught up!</h2>
                <p class="text-text-dim mb-8">No more items to label in data/to_label.csv</p>
                <a href="/admin"
                    class="inline-block bg-primary text-white px-8 py-3 font-bold hover:brightness-110 transition-all">Back
                    to Dashboard</a>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        async function submitLabel(label) {
            const currentUrl = document.getElementById('item-url')?.innerText;
            if (!currentUrl) return;

            // Simple transition effect
            const card = document.getElementById('item-card');
            card.style.opacity = '0.5';
            card.style.pointerEvents = 'none';

            try {
                const response = await fetch('/api/label', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: currentUrl, label: label })
                });

                const data = await response.json();
                if (data.success) {
                    if (data.next_item) {
                        updateItem(data.next_item);
                        card.style.opacity = '1';
                        card.style.pointerEvents = 'auto';
                    } else {
                        showEmptyState();
                    }
                }
            } catch (e) {
                console.error(e);
                alert('Error submitting label');
                card.style.opacity = '1';
                card.style.pointerEvents = 'auto';
            }
        }

        function updateItem(item) {
            document.getElementById('item-title').innerText = item.title || 'Untitled';
            document.getElementById('item-url').innerText = item.url;
            document.getElementById('item-url').href = item.url;
            document.getElementById('item-snippet').innerText = item.snippet;
        }

        function showEmptyState() {
            document.getElementById('label-container').innerHTML = `
                <div class="text-center py-20 bg-surface border border-border">
                    <h2 class="text-3xl font-bold text-white mb-4">All caught up!</h2>
                    <p class="text-text-dim mb-8">No more items to label in data/to_label.csv</p>
                    <a href="/admin" class="inline-block bg-primary text-white px-8 py-3 font-bold hover:brightness-110 transition-all">Back to Dashboard</a>
                </div>
            `;
        }

        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            if (key === 'g') submitLabel('good');
            if (key === 'b') submitLabel('bad');
            if (key === 'u') submitLabel('unsure');
        });
    </script>
</body>

</html>